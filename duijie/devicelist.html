<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="css/layui.css">
    <link rel="stylesheet" type="text/css" href="css/layui.mobile.css">
    <link rel="stylesheet" href="css/style.css">
    <title>设备列表获取</title>
</head>

<body>
    <p>
        <a class="layui-btn layui-btn-primary" href="#">
            < 返回 </a>
    </p>
    <div id="main" class="layui-fluid">
        <div id="content">
            <div class="layui-row">
                <p id="title" class="layui-col-xs12">
                    <button class="layui-btn layui-btn-radius layui-btn-primary textACenter">
                    设备列表
                </button>
                </p>
            </div>
            <div class="layui-row">
                <div class="layui-col-xs12">
                    <table id="devicelist" class="layui-table" lay-skin="line">
                        <colgroup>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                            <tr>
                                <th>设备号</th>
                                <th>设备名</th>
                                <th>序列号</th>
                                <th>上次联系时间</th>
                                <th>设备数据采集状态</th>
                                <th></th>
                            </tr>
                        </thead>

                        <tbody id="tbody">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="js/jquery-3.3.1.js"></script>
    <script src="js/common.js"></script>
    <script>
        $(function() {
            if (tokenValue == '') {
                alert("您还未登录，请先登录");
                return;
            }

            // 执行表格显示
            $.ajax({
                type: "get",
                url: basePath + "/devicelist",
                contentType: "application/json",
                dataType: "json",
                data: {
                    "token": tokenValue,
                    "hash": "test",
                },
                success: function(response) {
                    console.log(response)
                    if (response.status != '100') {
                        alert(response.msg);
                        return;
                    }
                    for (let i = 0; i < response.data.length; i++) {
                        const element = response.data[i];

                        var $tr = $('<tr></tr>');
                        var $td1 = `<td data-label="设备号">${element.id}</td>`;
                        var $td2 = `<td data-label="设备名">${element.name}</td>`;
                        var $td3 = `<td data-label="序列号">${element.serialNumber}</td>`;
                        var $td4 = `<td data-label="上次联系时间">${element.lastContact}</td>`;
                        var $td5 = `<td data-label="数据采集状态">${element.deviceCondition}</td>`;
                        if (element.deviceCondition == 0 || element.deviceCondition == null) {
                            $td5 = `<td data-label="数据采集状态"><button
                                    class="layui-btn layui-btn-sm layui-btn-radius layui-btn-warm">设备近期无数据上传</button>
                            </td>`;
                        }
                        var $td6 = `<td><button class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary"
                                style="text-align:center">查看详情</button> </td>`;

                        $tr.append($td1 + $td2 + $td3 + $td4 + $td5 + $td6);
                        $('#tbody').append($tr);
                    }
                }
            });

        })
    </script>
</body>

</html>